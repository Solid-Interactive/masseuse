<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/masseuseModel.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: models/masseuseModel.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>define(['backbone', './computedProperty', './proxyProperty', 'underscore'],
    function (Backbone, ComputedProperty, ProxyProperty, _) {
        'use strict';

        /**
         * A Backbone Model with Proxy and Computed Properties.
         * Proxy and Computed properties are tirggered directly and not via events for performance reasons.
         * @constructor
         * @class
         * @module MasseuseModel
         * @extends Backbone.Model
         */
        return Backbone.Model.extend({
            toggleAttribute : function (attribute) {
                this.set(attribute, !this.get(attribute));
            },
            set : function (key, val, options) {
                var self = this,
                    attrs = {},
                    stack = [],
                    delayInitial = [],
                    callSelf = false;

                this.computedCallbacks = this.computedCallbacks || {};
                if (key === null) {
                    return this;
                } else if (typeof key == 'object') {
                    attrs = key;
                    options = val;

                    _.each(key, function (attrValue, attrKey) {
                        if (attrValue instanceof ComputedProperty) {
                            if (!attrValue.skipInitialComputation) {
                                self.bindComputed(attrKey, attrValue);
                                callSelf = true;
                            } else {
                                delayInitial.push(function () {
                                    self.bindComputed(attrKey, attrValue);
                                });
                            }
                            delete attrs[attrKey];
                        } else if (attrValue instanceof ProxyProperty) {
                            self.bindProxy(attrKey, attrValue);
                            delete attrs[attrKey];
                        } else {
                            if (self.computedCallbacks[attrKey]) {
                                stack.push(self.computedCallbacks[attrKey]);
                            }
                        }
                    });
                } else {
                    attrs[key] = val;
                    if (val instanceof ComputedProperty) {
                        this.bindComputed(key, val);
                        return;
                    } else if (val instanceof ProxyProperty) {
                        this.bindProxy(key, val);
                        return;
                    } else {
                        _pushToComputedCallbacks.call(this, key, stack);
                    }
                }

                if (callSelf) {
                    this.set.apply(this, [attrs, options]);
                } else {
                    Backbone.Model.prototype.set.apply(this, [attrs, options]);
                    _.forEach(stack, function (callbackArray) {
                        _.forEach(callbackArray, function (callback) {
                            callback.call(self);
                        });
                    });
                }
                if (delayInitial) {
                    _.forEach(delayInitial, function (cb) {
                        cb();
                    });
                }
            },
            bindComputed : function (key, computed) {
                var self = this,
                    callback;

                callback = function () {
                    this.set(key, computed.callback.apply(this, this.getListenableValues(computed.listenables)));
                };

                _.forEach(computed.listenables, function (listenTo) {
                    self.computedCallbacks[listenTo] = self.computedCallbacks[listenTo] || [];
                    self.computedCallbacks[listenTo].push(callback);
                    if (!computed.skipInitialComputation) {
                        callback.call(self);
                    }
                });
            },
            bindProxy : function (key, proxy) {
                var self = this,
                    model = proxy.model,
                    modelAttribute = proxy.propertyNameOnModel;

                this.set(key, model.get(modelAttribute));

                model.on('change:' + modelAttribute, function () {
                    self.set(key, model.get(modelAttribute));
                });

                this.on('change:' + key, function () {
                    model.set(modelAttribute, self.get(key));
                });

            },
            getListenableValues : function (listenables) {
                var args = [],
                    self = this;

                _.each(listenables, function (listenablePropertyKey) {
                    args.push(self.get(listenablePropertyKey));
                });

                return args;
            }
        });

        function _pushToComputedCallbacks (key, stack) {
            if (this.computedCallbacks[key]) {
                stack.push(this.computedCallbacks[key]);
            }
        }
    });

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-BaseView.html">BaseView</a></li><li><a href="module-Channels.html">Channels</a></li><li><a href="module-ComputedProperty.html">ComputedProperty</a></li><li><a href="module-Masseuse.html">Masseuse</a></li><li><a href="module-MasseuseModel.html">MasseuseModel</a></li><li><a href="module-MasseuseRouter.html">MasseuseRouter</a></li><li><a href="module-ProxyProperty.html">ProxyProperty</a></li><li><a href="module-ViewContext.html">ViewContext</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Sat Jan 04 2014 15:16:58 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
